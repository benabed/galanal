import galanal as gnl 
import numpy as nm
import optimize as opt
import pmclite as pmc

# load the data
rq = gnl.rq("data/rq_spt_winter.cldf/")

lrange = gnl.lrange_class(100,1500,delta=30)
cl = "attic/base_plikHM_TTTEEE_lowl_lowE_lensing.minimum.theory_cl"
parbase = ["Ddust","beta_d","alpha","CIB","PS","CAL"]

# first learn about the foregrounds in the high freq map
pb545 = gnl.make_problem(rq,"TT",[(545,545)],lrange,cl,parbase[:-1])

cov545 = nm.array([[ 1.67109844e-02, -4.53178385e-03, -6.62783949e+02,
         3.77921241e+03],
       [-4.53178385e-03,  8.53348045e-03, -3.70620642e+03,
         5.22197542e+03],
       [-6.62783949e+02, -3.70620642e+03,  2.23028978e+09,
        -3.97038868e+09],
       [ 3.77921241e+03,  5.22197542e+03, -3.97038868e+09,
         8.61008529e+09]])

pos545 = nm.array([ 1.73234457e+00, -2.49414426e+00,  4.07944840e+05,  8.92182684e+05])
ch545 =  pmc.mcmc(pmc.add_lkl(pmc.repar_lkl(pb545[0],{"beta_d":1.5}),("gauss",[-2.5],[.1**2],["alpha"])),pos545,cov545,nstep=5000)
#init_guess = ch545.meandict()
init_guess = {'Ddust': 1.7448283345457654,
 'alpha': -2.492778687885418,
 'Acib_545_545': 404756.8849073447,
 'Aps_545_545': 900546.6300468558}
init_guess.update({"beta_d":1.5})

pb353 = gnl.make_problem(rq,"TT",[(353,353)],lrange,cl,parbase[:-1])
pos353 = [2000,6000]
cov353 = nm.array([[  241405.22895816, -1015415.63968401],
       [-1015415.63968401,  4367627.73384704]])
ch353 =  pmc.mcmc(pmc.repar_lkl(pb353[0],init_guess),pos353,cov353,nstep=5000)
#init_guess.update(ch353.meandict())
init_guess.update({'Acib_353_353': 2450.913079590127, 'Aps_353_353': 5205.662335110647})

pb353X545 = gnl.make_problem(rq,"TT",[(353,545)],lrange,cl,parbase[:-1])
pos353X545 = [nm.sqrt(init_guess["Acib_545_545"]*init_guess["Acib_353_353"]),nm.sqrt(init_guess["Aps_545_545"]*init_guess["Aps_353_353"])]
cov353X545 = nm.array([[  875879.13282249, -3566141.02760528],
       [-3566141.02760528, 17506895.2587434 ]])
ch353X545 =  pmc.mcmc(pmc.repar_lkl(pb353X545[0],init_guess),pos353X545,cov353X545,nstep=1000)
#init_guess.update(ch353X545.meandict())
init_guess.update({'Acib_353_545': 31090.52761992293, 'Aps_353_545': 66079.14341764463})

pb353_545 = gnl.make_problem(rq,"TT",[(353,353),(353,545),(545,545)],lrange,cl,parbase)
lkl353_545 = pmc.add_lkl(pmc.repar_lkl(pb353_545[0],{"beta_d":1.5,"cal_545":1}),("gauss",[-2.5],[.1**2],["alpha"]))
init_guess["cal_353"]=1
pos353_545 = nm.array([init_guess[p] for p in lkl353_545.paruse])

ch353_545 =  pmc.mcmc(pmc.repar_lkl(pb353_545[0],init_guess),pos353X545,cov353X545,nstep=1000)
#cov353_545 = pmc.add_sig(lkl353_545.paruse,(ch545.paruse,ch545.covariance()),(ch353.paruse,ch353.covariance()),(ch353X545.paruse,ch353X545.covariance()),(["cal_353"],[.1**2]))
cov353_545 = nm.array([[ 1.80561491e-02, -4.65539877e-03,  0.00000000e+00,
         0.00000000e+00, -7.83104572e+02,  0.00000000e+00,
         0.00000000e+00,  4.04141149e+03,  0.00000000e+00],
       [-4.65539877e-03,  8.27575452e-03,  0.00000000e+00,
         0.00000000e+00, -3.50547087e+03,  0.00000000e+00,
         0.00000000e+00,  4.87514563e+03,  0.00000000e+00],
       [ 0.00000000e+00,  0.00000000e+00,  1.93538788e+04,
         0.00000000e+00,  0.00000000e+00, -8.30659510e+04,
         0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
       [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         8.75879133e+05,  0.00000000e+00,  0.00000000e+00,
        -3.56614103e+06,  0.00000000e+00,  0.00000000e+00],
       [-7.83104572e+02, -3.50547087e+03,  0.00000000e+00,
         0.00000000e+00,  2.10433619e+09,  0.00000000e+00,
         0.00000000e+00, -3.74109342e+09,  0.00000000e+00],
       [ 0.00000000e+00,  0.00000000e+00, -8.30659510e+04,
         0.00000000e+00,  0.00000000e+00,  4.09479016e+05,
         0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
       [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
        -3.56614103e+06,  0.00000000e+00,  0.00000000e+00,
         1.75068953e+07,  0.00000000e+00,  0.00000000e+00],
       [ 4.04141149e+03,  4.87514563e+03,  0.00000000e+00,
         0.00000000e+00, -3.74109342e+09,  0.00000000e+00,
         0.00000000e+00,  8.17759524e+09,  0.00000000e+00],
       [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         0.00000000e+00,  0.00000000e+00,  1.00000000e-02]])

# after a few runs !
cov353_545 = nm.array([[ 8.24533024e-03, -1.86631785e-03,  9.71311409e-01,
        -1.79285577e+01, -4.77379382e+02, -1.31699890e+00,
         1.75960350e+02,  2.72617067e+03, -5.65161097e-05],
       [-1.86631785e-03,  4.42784678e-04,  5.29462209e-02,
         3.22894547e+00,  1.03075481e+02, -5.54937038e-01,
        -3.67541715e+01, -5.80756314e+02,  8.93666308e-06],
       [ 9.71311409e-01,  5.29462209e-02,  4.02122829e+03,
        -1.39864304e+04, -1.27535341e+05, -1.23715609e+04,
         6.47541027e+04,  8.41121850e+05, -6.18706708e-02],
       [-1.79285577e+01,  3.22894547e+00, -1.39864304e+04,
         7.50750037e+04,  1.25471730e+06,  3.99944755e+04,
        -5.16418927e+05, -7.50817853e+06,  2.90703440e-01],
       [-4.77379382e+02,  1.03075481e+02, -1.27535341e+05,
         1.25471730e+06,  2.89400218e+07,  2.99200325e+05,
        -1.09910371e+07, -1.67326505e+08,  4.27974926e+00],
       [-1.31699890e+00, -5.54937038e-01, -1.23715609e+04,
         3.99944755e+04,  2.99200325e+05,  3.84105718e+04,
        -1.65772123e+05, -2.06138210e+06,  1.81675799e-01],
       [ 1.75960350e+02, -3.67541715e+01,  6.47541027e+04,
        -5.16418927e+05, -1.09910371e+07, -1.65772123e+05,
         4.25122573e+06,  6.40377261e+07, -1.82828227e+00],
       [ 2.72617067e+03, -5.80756314e+02,  8.41121850e+05,
        -7.50817853e+06, -1.67326505e+08, -2.06138210e+06,
         6.40377261e+07,  9.70565394e+08, -2.60345945e+01],
       [-5.65161097e-05,  8.93666308e-06, -6.18706708e-02,
         2.90703440e-01,  4.27974926e+00,  1.81675799e-01,
        -1.82828227e+00, -2.60345945e+01,  1.16768068e-06]])


ch353_545 =  pmc.mcmc(lkl353_545,pos353_545,cov353_545,nstep=1000)

#init_guess.update(ch353_545.meandict())
init_guess.update({'Ddust': 1.6961882138775908,
 'alpha': -2.4767952931784873,
 'Acib_353_353': 2507.9658944102207,
 'Acib_353_545': 31005.468415989064,
 'Acib_545_545': 406427.22526269825,
 'Aps_353_353': 5017.112360150963,
 'Aps_353_545': 65748.62861840188,
 'Aps_545_545': 892820.5658749143,
 'cal_353': 0.999445804922204})

cov353_545 = ch353_545.covariance()

cov353_545 = nm.array([[ 8.24533024e-03, -1.86631785e-03,  9.71311409e-01,
        -1.79285577e+01, -4.77379382e+02, -1.31699890e+00,
         1.75960350e+02,  2.72617067e+03, -5.65161097e-05],
       [-1.86631785e-03,  4.42784678e-04,  5.29462209e-02,
         3.22894547e+00,  1.03075481e+02, -5.54937038e-01,
        -3.67541715e+01, -5.80756314e+02,  8.93666308e-06],
       [ 9.71311409e-01,  5.29462209e-02,  4.02122829e+03,
        -1.39864304e+04, -1.27535341e+05, -1.23715609e+04,
         6.47541027e+04,  8.41121850e+05, -6.18706708e-02],
       [-1.79285577e+01,  3.22894547e+00, -1.39864304e+04,
         7.50750037e+04,  1.25471730e+06,  3.99944755e+04,
        -5.16418927e+05, -7.50817853e+06,  2.90703440e-01],
       [-4.77379382e+02,  1.03075481e+02, -1.27535341e+05,
         1.25471730e+06,  2.89400218e+07,  2.99200325e+05,
        -1.09910371e+07, -1.67326505e+08,  4.27974926e+00],
       [-1.31699890e+00, -5.54937038e-01, -1.23715609e+04,
         3.99944755e+04,  2.99200325e+05,  3.84105718e+04,
        -1.65772123e+05, -2.06138210e+06,  1.81675799e-01],
       [ 1.75960350e+02, -3.67541715e+01,  6.47541027e+04,
        -5.16418927e+05, -1.09910371e+07, -1.65772123e+05,
         4.25122573e+06,  6.40377261e+07, -1.82828227e+00],
       [ 2.72617067e+03, -5.80756314e+02,  8.41121850e+05,
        -7.50817853e+06, -1.67326505e+08, -2.06138210e+06,
         6.40377261e+07,  9.70565394e+08, -2.60345945e+01],
       [-5.65161097e-05,  8.93666308e-06, -6.18706708e-02,
         2.90703440e-01,  4.27974926e+00,  1.81675799e-01,
        -1.82828227e+00, -2.60345945e+01,  1.16768068e-06]])



pb217_353_545 = gnl.make_problem(rq,"TT",gnl.get_fqc([217,353,545],[217,353,545],outer=True),lrange,cl,parbase)
lkl217_353_545 = pmc.add_lkl(pmc.repar_lkl(pb217_353_545[0],{"beta_d":1.5,"cal_545":1}),("gauss",[-2.5],[.01**2],["alpha"]))
init_guess.update({
                  'Acib_217_217':50,
                  'Acib_217_353':100,
                  'Acib_217_545':500,
                  'Aps_217_217':50,
                  'Aps_217_353':100,
                  'Aps_217_545':500,
                  'cal_217':1,})
cov217_353_545 = pmc.add_sig(lkl217_353_545.paruse,(lkl353_545.paruse,cov353_545),
                          (['Acib_217_217','Acib_217_353','Acib_217_545','Aps_217_217','Aps_217_353','Aps_217_545','cal_217'],
                          nm.array([10,10,30,10,10,30,.1])**2))


cov217_353_545 = nm.array([[ 4.10107467e-03, -6.48050827e-04,  5.41489620e-01,
         1.81264132e+00,  5.92782308e+00,  6.99324837e+00,
        -2.87056156e+01, -3.56245065e+02, -6.84851661e-01,
        -3.44582737e-01,  5.97923767e-01, -2.10137761e+01,
         1.60877641e+02,  2.22246851e+03, -1.49513099e-04,
        -1.19834486e-04],
       [-6.48050827e-04,  2.20056968e-04, -3.25152073e-01,
        -1.52520630e-01, -3.51783953e-01,  6.29974739e-02,
         9.85565446e-01,  3.49765860e+01,  1.43306382e-01,
        -6.53240006e-02, -7.37485667e-01, -3.32124405e-01,
        -1.22621271e+01, -1.95726890e+02,  8.10934997e-05,
         2.38389990e-06],
       [ 5.41489620e-01, -3.25152073e-01,  2.21962722e+03,
        -2.48594738e+01, -5.27397974e+03,  3.62624536e+03,
        -1.20027313e+04, -9.64183057e+04, -3.58633353e+03,
         2.63495115e+03,  5.75276449e+03, -1.12219396e+04,
         5.17620187e+04,  6.53255895e+05, -3.18184025e-01,
        -5.38774018e-02],
       [ 1.81264132e+00, -1.52520630e-01, -2.48594738e+01,
         3.62552488e+03,  2.76966193e+04,  7.46423067e+03,
        -2.59711732e+04, -2.37167283e+05,  4.20185334e+02,
        -9.87299351e+02,  1.85120240e+04, -2.29639061e+04,
         1.20347911e+05,  1.56376731e+06, -1.06884761e-01,
        -1.13131183e-01],
       [ 5.92782308e+00, -3.51783953e-01, -5.27397974e+03,
         2.76966193e+04,  2.83685552e+05,  3.69240737e+04,
        -1.22884074e+05, -1.00309234e+06,  9.17195842e+03,
        -7.07902643e+03,  2.20273996e+05, -1.14228198e+05,
         5.34257236e+05,  6.77394361e+06,  2.27034797e-01,
        -5.33824940e-01],
       [ 6.99324837e+00,  6.29974739e-02,  3.62624536e+03,
         7.46423067e+03,  3.69240737e+04,  4.69799665e+04,
        -1.55471389e+05, -1.24726486e+06, -1.36397090e+04,
         7.80228591e+03,  4.66743583e+04, -1.45433494e+05,
         6.69490700e+05,  8.45461791e+06, -8.24731292e-02,
        -6.97304711e-01],
       [-2.87056156e+01,  9.85565446e-01, -1.20027313e+04,
        -2.59711732e+04, -1.22884074e+05, -1.55471389e+05,
         5.24615739e+05,  4.43768199e+06,  4.26895485e+04,
        -2.30756974e+04, -1.42802059e+05,  4.80130799e+05,
        -2.32684246e+06, -2.97312863e+07,  5.22417014e-01,
         2.33675895e+00],
       [-3.56245065e+02,  3.49765860e+01, -9.64183057e+04,
        -2.37167283e+05, -1.00309234e+06, -1.24726486e+06,
         4.43768199e+06,  4.26224509e+07,  2.87229124e+05,
        -1.23273023e+05, -8.84350734e+05,  3.82570412e+06,
        -2.11868817e+07, -2.78195106e+08,  9.84249167e+00,
         1.94066703e+01],
       [-6.84851661e-01,  1.43306382e-01, -3.58633353e+03,
         4.20185334e+02,  9.17195842e+03, -1.36397090e+04,
         4.26895485e+04,  2.87229124e+05,  1.00865215e+04,
        -7.94390708e+03, -1.90522715e+04,  4.24946052e+04,
        -1.67564584e+05, -2.03105364e+06,  1.71768384e-01,
         1.95950786e-01],
       [-3.44582737e-01, -6.53240006e-02,  2.63495115e+03,
        -9.87299351e+02, -7.07902643e+03,  7.80228591e+03,
        -2.30756974e+04, -1.23273023e+05, -7.94390708e+03,
         7.16580704e+03,  1.93854887e+04, -2.44566301e+04,
         8.11561473e+04,  9.29728195e+05, -5.09168492e-02,
        -1.08063299e-01],
       [ 5.97923767e-01, -7.37485667e-01,  5.75276449e+03,
         1.85120240e+04,  2.20273996e+05,  4.66743583e+04,
        -1.42802059e+05, -8.84350734e+05, -1.90522715e+04,
         1.93854887e+04,  2.71433224e+05, -1.45781111e+05,
         5.37983592e+05,  6.39297333e+06, -3.32127102e-01,
        -6.44217577e-01],
       [-2.10137761e+01, -3.32124405e-01, -1.12219396e+04,
        -2.29639061e+04, -1.14228198e+05, -1.45433494e+05,
         4.80130799e+05,  3.82570412e+06,  4.24946052e+04,
        -2.44566301e+04, -1.45781111e+05,  4.50342803e+05,
        -2.05980704e+06, -2.59725436e+07,  2.26709179e-01,
         2.15528410e+00],
       [ 1.60877641e+02, -1.22621271e+01,  5.17620187e+04,
         1.20347911e+05,  5.34257236e+05,  6.69490700e+05,
        -2.32684246e+06, -2.11868817e+07, -1.67564584e+05,
         8.11561473e+04,  5.37983592e+05, -2.05980704e+06,
         1.07653811e+07,  1.39767722e+08, -3.92498314e+00,
        -1.02578302e+01],
       [ 2.22246851e+03, -1.95726890e+02,  6.53255895e+05,
         1.56376731e+06,  6.77394361e+06,  8.45461791e+06,
        -2.97312863e+07, -2.78195106e+08, -2.03105364e+06,
         9.29728195e+05,  6.39297333e+06, -2.59725436e+07,
         1.39767722e+08,  1.82516195e+09, -5.80826658e+01,
        -1.30540594e+02],
       [-1.49513099e-04,  8.10934997e-05, -3.18184025e-01,
        -1.06884761e-01,  2.27034797e-01, -8.24731292e-02,
         5.22417014e-01,  9.84249167e+00,  1.71768384e-01,
        -5.09168492e-02, -3.32127102e-01,  2.26709179e-01,
        -3.92498314e+00, -5.80826658e+01,  8.50987936e-05,
         1.89188340e-06],
       [-1.19834486e-04,  2.38389990e-06, -5.38774018e-02,
        -1.13131183e-01, -5.33824940e-01, -6.97304711e-01,
         2.33675895e+00,  1.94066703e+01,  1.95950786e-01,
        -1.08063299e-01, -6.44217577e-01,  2.15528410e+00,
        -1.02578302e+01, -1.30540594e+02,  1.89188340e-06,
         1.04350930e-05]])

ch217_353_545 =  pmc.mcmc(lkl217_353_545,init_guess,cov217_353_545,nstep=1000)
#init_guess.update(ch217_353_545.meandict())
init_guess.update({'Ddust': 1.7407949100938531,
 'alpha': -2.5027631088322884,
 'Acib_217_217': -26.510127297815583,
 'Acib_217_353': 432.9875079975021,
 'Acib_217_545': 4497.379472497491,
 'Acib_353_353': 2543.4217276089653,
 'Acib_353_545': 30818.399897530027,
 'Acib_545_545': 403311.7198208173,
 'Aps_217_217': 234.6201395150361,
 'Aps_217_353': 4.091338876694438,
 'Aps_217_545': 3824.028404713797,
 'Aps_353_353': 4915.540562088363,
 'Aps_353_545': 67033.9820382427,
 'Aps_545_545': 911476.3859404493,
 'cal_217': 1.0014289141065136,
 'cal_353': 0.9989897430476743}
)

init_guess.update({
                  'Acib_143_545':500,
                  'Aps_143_545':300,
                  'cal_545':1,
                  "beta_d":1.5})

pb143_217_353_545 = gnl.make_problem(rq,"TT",gnl.get_fqc([143,217,353,545],[353,545],outer=True,exclude=([[143,353]])),lrange,cl,parbase)
lkl143_217_353_545 = pmc.add_lkl(pmc.repar_lkl(pb143_217_353_545[0],{"cal_143":1}),("gauss",[-2.5,1.5],[.05**2,.05**2],["alpha","beta_d"]))
cov143_217_353_545 = pmc.add_sig(lkl143_217_353_545.paruse,(lkl217_353_545.paruse,cov217_353_545),
                          (['Acib_143_545','Aps_143_545','cal_545'],
                          nm.array([30,30,.05])**2))

parbase_T = ["Ddust","beta_d","alpha","T","CIB","PS","CAL"]
init_guess = {'Ddust': 1.7407949100938531,
 'alpha': -2.55,
 'Acib_217_353': 432.9875079975021,
 'Acib_217_545': 4497.379472497491,
 'Acib_353_353': 2543.4217276089653,
 'Acib_353_545': 30818.399897530027,
 'Acib_545_545': 403311.7198208173,
 'Aps_217_353': 4.091338876694438,
 'Aps_217_545': 3824.028404713797,
 'Aps_353_353': 4915.540562088363,
 'Aps_353_545': 67033.9820382427,
 'Aps_545_545': 911476.3859404493,
 "T":19.6,
 "beta_d":1.48}


pb217X353_545 = gnl.make_problem(rq,"TT",gnl.get_fqc([217,353,545],[353,545],outer=True),lrange,cl,parbase_T[:-1])
lkl217X353_545 = pmc.add_lkl(pmc.repar_lkl(pb217X353_545[0],{"T":19.6}),("gauss",[-2.55,1.48],[.05**2,.01**2],["alpha","beta_d"]))
cov217X353_545 = pmc.add_sig(lkl217X353_545.paruse,(lkl217_353_545.paruse,cov217_353_545))
cov217X353_545 = nm.array([[ 6.60265040e-03,  2.07756116e-06, -1.94237630e-03,
         2.89514835e-02, -6.05676829e+00,  3.53768141e+00,
        -2.27529237e+01, -4.32568045e+02,  1.56635093e+00,
         3.82488157e+01, -9.69142107e+00,  1.71954452e+02,
         2.55057558e+03],
       [ 2.07756116e-06,  4.23200193e-08, -1.34837952e-06,
        -8.64732405e-03, -8.65804784e-02,  7.48164106e-03,
        -2.65118491e-02, -2.52330904e-01,  3.63345418e-02,
         3.44294706e-01, -2.29564379e-02,  1.25829886e-01,
         1.64694721e+00],
       [-1.94237630e-03, -1.34837952e-06,  7.59764504e-04,
         2.61512451e-01,  4.40767881e+00, -1.57934753e+00,
         8.33043275e+00,  1.37082720e+02, -1.69621391e+00,
        -2.22352821e+01,  4.53468506e+00, -5.66648382e+01,
        -8.21989598e+02],
       [ 2.89514835e-02, -8.64732405e-03,  2.61512451e-01,
         5.21207150e+03,  3.12040846e+04, -1.39051146e+03,
         4.14841155e+03,  2.37833244e+04, -2.05301665e+04,
        -1.19008983e+05,  4.33582850e+03, -1.52004133e+04,
        -1.74681351e+05],
       [-6.05676829e+00, -8.65804784e-02,  4.40767881e+00,
         3.12040846e+04,  2.74437686e+05, -2.41128452e+04,
         8.42045504e+04,  7.77401937e+05, -1.27456201e+05,
        -1.03628078e+06,  7.40746080e+04, -3.93218383e+05,
        -5.10829044e+06],
       [ 3.53768141e+00,  7.48164106e-03, -1.57934753e+00,
        -1.39051146e+03, -2.41128452e+04,  1.17114429e+04,
        -4.20305289e+04, -4.10849307e+05,  7.40755241e+03,
         1.01335264e+05, -3.58874173e+04,  2.02761592e+05,
         2.67278421e+06],
       [-2.27529237e+01, -2.65118491e-02,  8.33043275e+00,
         4.14841155e+03,  8.42045504e+04, -4.20305289e+04,
         1.69116941e+05,  2.03502885e+06, -2.52602313e+04,
        -3.77141832e+05,  1.26706271e+05, -9.28859458e+05,
        -1.27600679e+07],
       [-4.32568045e+02, -2.52330904e-01,  1.37082720e+02,
         2.37833244e+04,  7.77401937e+05, -4.10849307e+05,
         2.03502885e+06,  3.16065183e+07, -2.22589048e+05,
        -3.97998174e+06,  1.19491585e+06, -1.32837744e+07,
        -1.90929104e+08],
       [ 1.56635093e+00,  3.63345418e-02, -1.69621391e+00,
        -2.05301665e+04, -1.27456201e+05,  7.40755241e+03,
        -2.52602313e+04, -2.22589048e+05,  8.37169486e+04,
         4.97372771e+05, -2.27645219e+04,  1.15260459e+05,
         1.47414265e+06],
       [ 3.82488157e+01,  3.44294706e-01, -2.22352821e+01,
        -1.19008983e+05, -1.03628078e+06,  1.01335264e+05,
        -3.77141832e+05, -3.97998174e+06,  4.97372771e+05,
         4.18182403e+06, -3.08670372e+05,  1.90827899e+06,
         2.54992046e+07],
       [-9.69142107e+00, -2.29564379e-02,  4.53468506e+00,
         4.33582850e+03,  7.40746080e+04, -3.58874173e+04,
         1.26706271e+05,  1.19491585e+06, -2.27645219e+04,
        -3.08670372e+05,  1.10208689e+05, -5.98334372e+05,
        -7.82826249e+06],
       [ 1.71954452e+02,  1.25829886e-01, -5.66648382e+01,
        -1.52004133e+04, -3.93218383e+05,  2.02761592e+05,
        -9.28859458e+05, -1.32837744e+07,  1.15260459e+05,
         1.90827899e+06, -5.98334372e+05,  5.72508516e+06,
         8.11463980e+07],
       [ 2.55057558e+03,  1.64694721e+00, -8.21989598e+02,
        -1.74681351e+05, -5.10829044e+06,  2.67278421e+06,
        -1.27600679e+07, -1.90929104e+08,  1.47414265e+06,
         2.54992046e+07, -7.82826249e+06,  8.11463980e+07,
         1.15908998e+09]])

ch217X353_545 =  pmc.mcmc(lkl217X353_545,init_guess,ch217X353_545.covariance(),nstep=5000)
#ch217X353_545.tofile("ch217X353_545.npz")
ch217X353_545 = gnl.chain("ch217X353_545.npz")

res217X353_545 = ch217X353_545.meandict()
res217X353_545 = {'Ddust': 1.501575473246576,
 'beta_d': 1.6000551909065635,
 'alpha': -2.5705436866044318,
 'Acib_217_353': 298.66990846482804,
 'Acib_217_545': 4040.8426844052015,
 'Acib_353_353': 2447.145308414221,
 'Acib_353_545': 31546.168748991142,
 'Acib_545_545': 418404.10642005975,
 'Aps_217_353': 688.7861643626335,
 'Aps_217_545': 7069.467634249622,
 'Aps_353_353': 5167.263852581081,
 'Aps_353_545': 61165.47949268547,
 'Aps_545_545': 823324.9919520708}


std217X353_545 = ch217X353_545.stddict()
std217X353_545 = {'Ddust': 0.08125669451241813,
 'beta_d': 0.00020571830088469623,
 'alpha': 0.02756382600166867,
 'Acib_217_353': 72.19467780323261,
 'Acib_217_545': 523.8680045209727,
 'Acib_353_353': 108.21942031121954,
 'Acib_353_545': 411.23830254947313,
 'Acib_545_545': 5621.967475977322,
 'Aps_217_353': 289.3388127265979,
 'Aps_217_545': 2044.9508618075383,
 'Aps_353_353': 331.9769406233223,
 'Aps_353_545': 2392.7150186073914,
 'Aps_545_545': 34045.410528891945}

